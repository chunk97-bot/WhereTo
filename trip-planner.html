<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trip Planner - WhereTo | Plan Your Perfect Journey</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Plan your perfect trip with AI-powered itinerary generation. Save destinations and create custom travel plans based on geography.">
    <meta name="keywords" content="trip planner, travel itinerary, AI trip planning, travel route planner">
    <meta name="robots" content="index, follow">
    
    <link rel="icon" type="image/png" href="favicon.png">
    <meta name="theme-color" content="#0f0f23">
    
    <link rel="stylesheet" href="style.css?v=2">
    <link rel="stylesheet" href="pages.css?v=5">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700;800&family=Righteous&display=swap" rel="stylesheet">
    <script src="destinations-data.js"></script>
    
    <style>
        /* Trip Planner Specific Styles */
        .planner-header {
            text-align: center;
            padding: 3rem 2rem;
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .planner-header h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #fff 0%, #00d4ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .planner-header h1::before {
            content: 'üóìÔ∏è ';
            -webkit-text-fill-color: initial;
        }

        .planner-header p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.1rem;
        }

        .planner-content {
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Saved Destinations Section */
        .saved-section {
            margin-bottom: 3rem;
        }

        .section-title {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-title .emoji {
            font-family: 'Segoe UI Emoji', 'Apple Color Emoji', 'Noto Color Emoji', sans-serif;
            -webkit-text-fill-color: initial;
        }

        .saved-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .saved-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            position: relative;
        }

        .saved-card:hover {
            transform: translateY(-5px);
            border-color: rgba(0, 212, 255, 0.3);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .saved-card-image {
            height: 150px;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .saved-card-image::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(to top, rgba(15, 15, 35, 1), transparent);
        }

        .remove-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(239, 68, 68, 0.9);
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            font-size: 1rem;
            z-index: 2;
            transition: all 0.3s ease;
        }

        .remove-btn:hover {
            background: #ef4444;
            transform: scale(1.1);
        }

        .saved-card-content {
            padding: 1rem;
        }

        .saved-card h3 {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .saved-card p {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 0.5rem;
        }

        .saved-card-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .saved-tag {
            padding: 0.25rem 0.75rem;
            background: rgba(0, 212, 255, 0.15);
            border-radius: 20px;
            font-size: 0.75rem;
            color: #00d4ff;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 20px;
            border: 2px dashed rgba(255, 255, 255, 0.1);
        }

        .empty-state .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            font-family: 'Segoe UI Emoji', 'Apple Color Emoji', 'Noto Color Emoji', sans-serif;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .empty-state p {
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 1.5rem;
        }

        .explore-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.8rem 2rem;
            background: linear-gradient(135deg, #00d4ff 0%, #8b5cf6 100%);
            border: none;
            border-radius: 30px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .explore-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.3);
        }

        /* Generate Itinerary Section */
        .generate-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 2rem;
        }

        .generate-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .generate-header h2 {
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .date-inputs {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .date-group {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
        }

        .date-group label {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .date-group input {
            padding: 0.6rem 1rem;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
            color-scheme: dark;
        }

        .date-group input:focus {
            outline: none;
            border-color: #00d4ff;
        }

        /* Custom date picker styling */
        .date-group input::-webkit-calendar-picker-indicator {
            filter: invert(1);
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s ease;
        }

        .date-group input::-webkit-calendar-picker-indicator:hover {
            opacity: 1;
        }

        .date-group input::-webkit-datetime-edit {
            color: #00d4ff;
        }

        .date-group input::-webkit-datetime-edit-fields-wrapper {
            color: #00d4ff;
        }

        .date-group input::-webkit-datetime-edit-text {
            color: rgba(255, 255, 255, 0.5);
        }

        .date-group input::-webkit-datetime-edit-month-field,
        .date-group input::-webkit-datetime-edit-day-field,
        .date-group input::-webkit-datetime-edit-year-field {
            color: #00d4ff;
        }

        .date-group input::-webkit-datetime-edit-month-field:focus,
        .date-group input::-webkit-datetime-edit-day-field:focus,
        .date-group input::-webkit-datetime-edit-year-field:focus {
            background: rgba(0, 212, 255, 0.2);
            color: white;
        }

        .generate-btn {
            padding: 1rem 2.5rem;
            background: linear-gradient(135deg, #00d4ff 0%, #8b5cf6 100%);
            border: none;
            border-radius: 30px;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.3);
        }

        .generate-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Itinerary Output */
        .itinerary-output {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            padding: 2rem;
            min-height: 300px;
        }

        .itinerary-placeholder {
            text-align: center;
            padding: 3rem;
            color: rgba(255, 255, 255, 0.5);
        }

        .itinerary-placeholder .placeholder-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            font-family: 'Segoe UI Emoji', 'Apple Color Emoji', 'Noto Color Emoji', sans-serif;
        }

        /* Generated Itinerary Styles */
        .itinerary-result {
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .itinerary-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .itinerary-header h2 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #fff 0%, #00d4ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .itinerary-header h2 .header-emoji {
            -webkit-text-fill-color: initial;
            background: none;
            -webkit-background-clip: initial;
            background-clip: initial;
        }

        .itinerary-header p {
            color: rgba(255, 255, 255, 0.6);
        }

        .day-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .day-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .day-number {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #00d4ff 0%, #8b5cf6 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
        }

        .day-info h3 {
            font-size: 1.1rem;
            margin-bottom: 0.2rem;
        }

        .day-info span {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.5);
        }

        .day-activities {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .activity-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
        }

        .activity-time {
            min-width: 70px;
            padding: 0.3rem 0.6rem;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 6px;
            font-size: 0.8rem;
            color: #00d4ff;
            text-align: center;
        }

        .activity-details h4 {
            font-size: 0.95rem;
            margin-bottom: 0.2rem;
        }

        .activity-details p {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
        }

        /* Travel Tips Section */
        .travel-tips {
            background: rgba(139, 92, 246, 0.1);
            border-radius: 16px;
            padding: 1.5rem;
            margin-top: 2rem;
            border: 1px solid rgba(139, 92, 246, 0.2);
        }

        .travel-tips h3 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            color: #a78bfa;
        }

        .travel-tips ul {
            list-style: none;
            padding: 0;
        }

        .travel-tips li {
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
            color: rgba(255, 255, 255, 0.8);
        }

        .travel-tips li::before {
            content: '‚úì';
            position: absolute;
            left: 0;
            color: #22c55e;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .planner-header h1 {
                font-size: 1.8rem;
            }

            .generate-header {
                flex-direction: column;
                align-items: stretch;
            }

            .date-inputs {
                justify-content: center;
            }

            .generate-btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="page-container">
        <!-- Navigation -->
        <nav class="main-nav">
            <div class="nav-brand">
                <a href="home.html">
                    <svg viewBox="0 0 200 50" class="nav-logo-svg">
                        <text x="5" y="35" class="nav-brand-text">WhereTo</text>
                        <circle cx="175" cy="28" r="6" fill="#ff6b6b" class="nav-pin-dot"/>
                        <circle cx="175" cy="27" r="2.5" fill="white"/>
                        <g class="nav-flying-plane">
                            <path d="M0 0 L-6 -2 L-5 0 L-6 2 Z" fill="#008cff"/>
                            <path d="M-3 -4 L-1.5 0 L-3 4 L-4 0 Z" fill="#008cff" opacity="0.7"/>
                        </g>
                        <path class="nav-plane-trail" d="M100 38 Q130 25 150 30 Q170 35 180 22" 
                              fill="none" stroke="rgba(0,140,255,0.3)" stroke-width="1.5" 
                              stroke-dasharray="4 3" stroke-linecap="round"/>
                    </svg>
                </a>
            </div>
            <div class="nav-links">
                <a href="home.html" class="nav-link">üè† Home</a>
                <a href="index.html" class="nav-link"><svg class="nav-robot-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="robotHead7" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#00f5ff"/><stop offset="50%" style="stop-color:#8b5cf6"/><stop offset="100%" style="stop-color:#ec4899"/></linearGradient><linearGradient id="robotGlow7" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:#fff;stop-opacity:0.8"/><stop offset="100%" style="stop-color:#fff;stop-opacity:0"/></linearGradient><filter id="neonGlow7"><feGaussianBlur stdDeviation="0.5" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs><rect x="4" y="7" width="16" height="13" rx="4" fill="url(#robotHead7)" filter="url(#neonGlow7)"/><rect x="5" y="8" width="14" height="4" rx="2" fill="url(#robotGlow7)" opacity="0.4"/><rect x="7" y="3" width="10" height="5" rx="2.5" fill="url(#robotHead7)"/><circle cx="8.5" cy="12.5" r="2.5" fill="#0a0a1a"/><circle cx="15.5" cy="12.5" r="2.5" fill="#0a0a1a"/><circle cx="8.5" cy="12.5" r="1.5" fill="#00f5ff"><animate attributeName="opacity" values="1;0.5;1" dur="2s" repeatCount="indefinite"/></circle><circle cx="15.5" cy="12.5" r="1.5" fill="#00f5ff"><animate attributeName="opacity" values="1;0.5;1" dur="2s" repeatCount="indefinite"/></circle><rect x="10" y="16" width="4" height="2" rx="1" fill="#ec4899"/><rect x="11" y="0" width="2" height="4" rx="1" fill="url(#robotHead7)"/><circle cx="12" cy="0" r="1.5" fill="#00f5ff"><animate attributeName="r" values="1.5;2;1.5" dur="1.5s" repeatCount="indefinite"/></circle><rect x="1" y="10" width="3" height="6" rx="1.5" fill="url(#robotHead7)"/><rect x="20" y="10" width="3" height="6" rx="1.5" fill="url(#robotHead7)"/></svg> NOVA</a>
                <a href="destinations.html" class="nav-link">üåç Destinations</a>
                <a href="trip-planner.html" class="nav-link active">üóìÔ∏è Trip Planner</a>
                <a href="visa-guide.html" class="nav-link"><svg class="nav-visa-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 5L20 2V20L4 23Z" fill="#4a90c2"/><path d="M4 5L20 2L21 3L5 6Z" fill="#7fc4e8"/><path d="M20 2L21 3V21L20 20Z" fill="#2d5a87"/><circle cx="12" cy="11" r="4" stroke="#fff" stroke-width="1.2" fill="none"/><line x1="9" y1="14" x2="15" y2="8" stroke="#fff" stroke-width="1.2"/><rect x="7" y="17" width="8" height="1" fill="#fff" opacity="0.6"/></svg> Visa Guide</a>
                <a href="budget-calculator.html" class="nav-link">üí∞ Budget</a>
                <a href="currency-converter.html" class="nav-link">üí± Currency</a>
            </div>
            <button class="nav-toggle" id="navToggle">‚ò∞</button>
        </nav>

        <!-- Page Header -->
        <header class="planner-header">
            <h1>Trip Planner</h1>
            <p>Save destinations and create AI-powered travel itineraries</p>
        </header>

        <!-- Main Content -->
        <main class="planner-content">
            <!-- Saved Destinations -->
            <section class="saved-section">
                <h2 class="section-title"><span class="emoji">üìç</span> Your Saved Destinations</h2>
                <div class="saved-grid" id="savedGrid">
                    <!-- Loaded dynamically -->
                </div>
            </section>

            <!-- Generate Itinerary -->
            <section class="generate-section" id="generateSection">
                <div class="generate-header">
                    <h2><span class="emoji">‚ú®</span> Generate AI Itinerary</h2>
                    <div class="date-inputs">
                        <div class="date-group">
                            <label>Start Date</label>
                            <input type="date" id="startDate">
                        </div>
                        <div class="date-group">
                            <label>End Date</label>
                            <input type="date" id="endDate">
                        </div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 1.5rem;">
                    <button class="generate-btn" id="generateBtn" onclick="generateItinerary()">
                        <span>ü§ñ</span> Generate Smart Itinerary
                    </button>
                </div>
            </section>

            <!-- Itinerary Output -->
            <div class="itinerary-output" id="itineraryOutput">
                <div class="itinerary-placeholder">
                    <div class="placeholder-icon">üó∫Ô∏è</div>
                    <h3>Your Itinerary Will Appear Here</h3>
                    <p>Save at least 2 destinations, set your dates, and click "Generate Smart Itinerary" to create an AI-optimized travel plan based on geography</p>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="page-footer">
            <div class="footer-content">
                <div class="footer-brand">
                    <h3>WhereTo</h3>
                    <p>Your Next Journey Starts Here</p>
                </div>
                <div class="footer-links">
                    <a href="index.html">NOVA</a>
                    <a href="destinations.html">Destinations</a>
                    <a href="trip-planner.html">Trip Planner</a>
                    <a href="visa-guide.html">Visa Guide</a>
                    <a href="budget-calculator.html">Budget</a>
                    <a href="currency-converter.html">Currency</a>
                </div>
                <div class="footer-bottom">
                    <p>Made with ‚ù§Ô∏è for travelers everywhere</p>
                    <p>¬© 2026 WhereTo. All rights reserved.</p>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Mobile nav toggle
        document.getElementById('navToggle').addEventListener('click', function() {
            document.querySelector('.nav-links').classList.toggle('show');
        });

        // Set default dates
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date();
            const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
            const twoWeeks = new Date(today.getTime() + 14 * 24 * 60 * 60 * 1000);
            
            document.getElementById('startDate').valueAsDate = nextWeek;
            document.getElementById('endDate').valueAsDate = twoWeeks;
            
            loadSavedDestinations();
        });

        // Load saved destinations from localStorage
        function loadSavedDestinations() {
            const saved = JSON.parse(localStorage.getItem('tripPlanner') || '[]');
            const grid = document.getElementById('savedGrid');
            
            if (saved.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="empty-icon">üìç</div>
                        <h3>No Destinations Saved Yet</h3>
                        <p>Go to Destinations and click "Save to Trip" on places you want to visit</p>
                        <a href="destinations.html" class="explore-btn">
                            <span>üåç</span> Explore Destinations
                        </a>
                    </div>
                `;
                document.getElementById('generateSection').style.display = 'none';
                return;
            }

            document.getElementById('generateSection').style.display = 'block';
            
            grid.innerHTML = saved.map(dest => `
                <div class="saved-card" data-id="${dest.id}">
                    <button class="remove-btn" onclick="removeDestination('${dest.id}')" title="Remove">√ó</button>
                    <div class="saved-card-image" style="background-image: url('${dest.image}')"></div>
                    <div class="saved-card-content">
                        <h3>${dest.flag || ''} ${dest.name}</h3>
                        <p>${dest.country}</p>
                        <div class="saved-card-tags">
                            ${(dest.categories || []).slice(0, 3).map(cat => {
                                const catInfo = destinationCategories.find(c => c.id === cat);
                                return catInfo ? `<span class="saved-tag">${catInfo.icon} ${catInfo.name}</span>` : '';
                            }).join('')}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Remove destination from saved
        function removeDestination(id) {
            let saved = JSON.parse(localStorage.getItem('tripPlanner') || '[]');
            // Convert to number for comparison since IDs are stored as numbers
            const numId = parseInt(id, 10);
            saved = saved.filter(dest => dest.id !== numId);
            localStorage.setItem('tripPlanner', JSON.stringify(saved));
            loadSavedDestinations();
        }

        // Generate AI Itinerary
        function generateItinerary() {
            const saved = JSON.parse(localStorage.getItem('tripPlanner') || '[]');
            const startDate = new Date(document.getElementById('startDate').value);
            const endDate = new Date(document.getElementById('endDate').value);
            const output = document.getElementById('itineraryOutput');

            if (saved.length < 2) {
                output.innerHTML = `
                    <div class="itinerary-placeholder">
                        <div class="placeholder-icon">‚ö†Ô∏è</div>
                        <h3>Need More Destinations</h3>
                        <p>Please save at least 2 destinations to generate an optimized itinerary</p>
                    </div>
                `;
                return;
            }

            const days = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
            if (days < 1) {
                output.innerHTML = `
                    <div class="itinerary-placeholder">
                        <div class="placeholder-icon">üìÖ</div>
                        <h3>Invalid Dates</h3>
                        <p>Please select valid start and end dates</p>
                    </div>
                `;
                return;
            }

            // Optimize route based on regions/geography
            const optimizedRoute = optimizeRoute(saved);
            
            // Generate day-by-day itinerary
            const daysPerDest = Math.max(1, Math.floor(days / optimizedRoute.length));
            const extraDays = days % optimizedRoute.length;

            let html = `
                <div class="itinerary-result">
                    <div class="itinerary-header">
                        <h2><span class="header-emoji">üó∫Ô∏è</span> Your ${days}-Day Adventure</h2>
                        <p>${optimizedRoute.length} destinations ¬∑ Optimized by geography</p>
                    </div>
            `;

            let currentDay = 1;
            const dateOptions = { weekday: 'short', month: 'short', day: 'numeric' };

            optimizedRoute.forEach((dest, index) => {
                const daysHere = daysPerDest + (index < extraDays ? 1 : 0);
                
                for (let d = 0; d < daysHere; d++) {
                    const currentDate = new Date(startDate);
                    currentDate.setDate(currentDate.getDate() + currentDay - 1);
                    
                    const isFirstDay = d === 0;
                    const isLastDay = d === daysHere - 1 && index < optimizedRoute.length - 1;
                    
                    html += `
                        <div class="day-card">
                            <div class="day-header">
                                <div class="day-number">D${currentDay}</div>
                                <div class="day-info">
                                    <h3>${dest.flag || ''} ${dest.name}</h3>
                                    <span>${currentDate.toLocaleDateString('en-US', dateOptions)}</span>
                                </div>
                            </div>
                            <div class="day-activities">
                                ${generateDayActivities(dest, isFirstDay, isLastDay, d + 1)}
                            </div>
                        </div>
                    `;
                    currentDay++;
                }
            });

            html += `
                    <div class="travel-tips">
                        <h3>üí° Smart Travel Tips</h3>
                        <ul>
                            ${generateTravelTips(optimizedRoute)}
                        </ul>
                    </div>
                </div>
            `;

            output.innerHTML = html;
        }

        // Optimize route based on geography
        function optimizeRoute(destinations) {
            // Group by region for smarter routing
            const regionOrder = ['asia', 'middleEast', 'europe', 'africa', 'northAmerica', 'southAmerica', 'oceania'];
            
            return [...destinations].sort((a, b) => {
                const aRegion = regionOrder.indexOf(a.region);
                const bRegion = regionOrder.indexOf(b.region);
                
                if (aRegion !== bRegion) return aRegion - bRegion;
                
                // Within same region, group by country
                return (a.country || '').localeCompare(b.country || '');
            });
        }

        // Generate activities for a day
        function generateDayActivities(dest, isFirstDay, isLastDay, dayNum) {
            const activities = [];
            
            if (isFirstDay) {
                activities.push({
                    time: '09:00',
                    title: `Arrive in ${dest.name}`,
                    desc: 'Check into accommodation and freshen up'
                });
                activities.push({
                    time: '11:00',
                    title: 'Explore the area',
                    desc: 'Get oriented with the local neighborhood'
                });
            } else {
                activities.push({
                    time: '08:00',
                    title: 'Breakfast',
                    desc: 'Try local cuisine at a nearby restaurant'
                });
            }

            // Add destination-specific activities based on categories
            const categories = dest.categories || [];
            
            if (categories.includes('heritage') || categories.includes('cultural')) {
                activities.push({
                    time: '10:00',
                    title: 'Historical Sites',
                    desc: `Visit famous landmarks and monuments in ${dest.name}`
                });
            }
            
            if (categories.includes('beach')) {
                activities.push({
                    time: '14:00',
                    title: 'Beach Time',
                    desc: 'Relax at the beautiful beaches'
                });
            }

            if (categories.includes('adventure')) {
                activities.push({
                    time: '15:00',
                    title: 'Adventure Activity',
                    desc: 'Experience local adventure sports or activities'
                });
            }

            if (categories.includes('food')) {
                activities.push({
                    time: '13:00',
                    title: 'Food Tour',
                    desc: 'Sample local delicacies and street food'
                });
            }

            if (categories.includes('shopping')) {
                activities.push({
                    time: '16:00',
                    title: 'Shopping',
                    desc: 'Explore local markets and shops'
                });
            }

            activities.push({
                time: '19:00',
                title: 'Dinner',
                desc: 'Experience local dining scene'
            });

            if (isLastDay) {
                activities.push({
                    time: '21:00',
                    title: 'Pack & Rest',
                    desc: 'Prepare for travel to next destination'
                });
            }

            return activities.map(act => `
                <div class="activity-item">
                    <span class="activity-time">${act.time}</span>
                    <div class="activity-details">
                        <h4>${act.title}</h4>
                        <p>${act.desc}</p>
                    </div>
                </div>
            `).join('');
        }

        // Generate travel tips
        function generateTravelTips(destinations) {
            const tips = [
                'Book flights between destinations in advance for better rates',
                'Keep digital copies of all documents in cloud storage',
                'Download offline maps for each destination'
            ];

            // Add region-specific tips
            const regions = [...new Set(destinations.map(d => d.region))];
            
            if (regions.includes('europe')) {
                tips.push('Consider a Eurail pass if traveling between multiple European cities');
            }
            if (regions.includes('asia')) {
                tips.push('Carry cash - many Asian destinations prefer local currency');
            }
            if (destinations.length > 3) {
                tips.push('Consider travel insurance for multi-destination trips');
            }

            return tips.map(tip => `<li>${tip}</li>`).join('');
        }
    </script>
</body>
</html>
