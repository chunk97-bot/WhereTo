<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>City Details - WhereTo | Travel Guide</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Complete travel guide with attractions, tips, budget information, and best time to visit.">
    <meta name="robots" content="index, follow">
    
    <link rel="icon" type="image/png" href="favicon.png">
    <meta name="theme-color" content="#0f0f23">
    
    <link rel="stylesheet" href="../css/style.css?v=2">
    <link rel="stylesheet" href="../css/pages.css?v=4">
    
    <!-- Leaflet CSS for Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- html2canvas for map download -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700;800&family=Righteous&display=swap" rel="stylesheet">
    
    <style>
        /* City Detail Specific Styles - Matching destination-detail.html */
        .detail-hero {
            position: relative;
            height: 50vh;
            min-height: 350px;
            max-height: 500px;
            background-size: cover;
            background-position: center;
        }

        .hero-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, 
                rgba(15, 15, 35, 0.3) 0%, 
                rgba(15, 15, 35, 0.5) 50%,
                rgba(15, 15, 35, 0.95) 100%);
        }

        .hero-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .breadcrumb {
            display: flex;
            gap: 0.5rem;
            font-size: 0.85rem;
            margin-bottom: 1rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .breadcrumb a {
            color: #00d4ff;
            text-decoration: none;
        }

        .dest-title {
            font-family: 'Poppins', sans-serif;
            font-size: 3rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #fff 0%, #00d4ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .dest-subtitle {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            align-items: center;
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .dest-location {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .detail-main {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 2rem;
        }

        .detail-content {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .detail-sidebar {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        /* Info Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-card h3 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Quick Info */
        .quick-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .info-item {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .info-label {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
        }

        .info-value {
            font-size: 1rem;
            font-weight: 600;
            color: #00d4ff;
        }

        /* Description */
        .description-text {
            line-height: 1.8;
            color: rgba(255, 255, 255, 0.8);
        }

        /* Budget Section */
        .budget-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
        }

        .budget-item {
            text-align: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .budget-item.budget {
            border-color: rgba(34, 197, 94, 0.3);
        }

        .budget-item.mid {
            border-color: rgba(251, 191, 36, 0.3);
        }

        .budget-item.luxury {
            border-color: rgba(168, 85, 247, 0.3);
        }

        .budget-label {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 0.25rem;
        }

        .budget-value {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .budget-item.budget .budget-value { color: #22c55e; }
        .budget-item.mid .budget-value { color: #fbbf24; }
        .budget-item.luxury .budget-value { color: #a855f7; }

        /* Highlights & Attractions Tags */
        .highlights-section h3 {
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .highlights-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .highlight-item {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            padding: 0.5rem 1rem;
            border-radius: 25px;
            font-size: 0.85rem;
            color: #00d4ff;
            cursor: default;
            transition: all 0.2s ease;
        }

        .highlight-item:hover {
            background: rgba(0, 212, 255, 0.2);
            transform: translateY(-2px);
        }

        /* Perfect For Section */
        .perfect-for-section h3 {
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .perfect-for-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .perfect-tag {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            font-size: 0.85rem;
            cursor: default;
            transition: all 0.2s ease;
        }

        .perfect-tag:hover {
            transform: translateY(-2px);
        }

        .perfect-tag.cultural { background: rgba(139, 92, 246, 0.15); border: 1px solid rgba(139, 92, 246, 0.4); color: #a78bfa; }
        .perfect-tag.food { background: rgba(251, 191, 36, 0.15); border: 1px solid rgba(251, 191, 36, 0.4); color: #fbbf24; }
        .perfect-tag.shopping { background: rgba(236, 72, 153, 0.15); border: 1px solid rgba(236, 72, 153, 0.4); color: #ec4899; }
        .perfect-tag.nightlife { background: rgba(168, 85, 247, 0.15); border: 1px solid rgba(168, 85, 247, 0.4); color: #c084fc; }
        .perfect-tag.nature { background: rgba(34, 197, 94, 0.15); border: 1px solid rgba(34, 197, 94, 0.4); color: #22c55e; }
        .perfect-tag.adventure { background: rgba(245, 158, 11, 0.15); border: 1px solid rgba(245, 158, 11, 0.4); color: #f59e0b; }
        .perfect-tag.history { background: rgba(180, 83, 9, 0.15); border: 1px solid rgba(180, 83, 9, 0.4); color: #d97706; }
        .perfect-tag.beach { background: rgba(59, 130, 246, 0.15); border: 1px solid rgba(59, 130, 246, 0.4); color: #3b82f6; }
        .perfect-tag.romantic { background: rgba(244, 63, 94, 0.15); border: 1px solid rgba(244, 63, 94, 0.4); color: #f43f5e; }

        /* Time Estimate Badge */
        .time-badge {
            background: rgba(0, 212, 255, 0.15);
            border: 1px solid rgba(0, 212, 255, 0.3);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            color: #00d4ff;
            white-space: nowrap;
        }

        /* CTA Card */
        .cta-card {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
            border: 1px solid rgba(0, 212, 255, 0.3);
        }

        .cta-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, #00d4ff 0%, #8b5cf6 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .nova-btn-icon {
            width: 24px;
            height: 24px;
            flex-shrink: 0;
        }

        .trip-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e53 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .trip-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 107, 107, 0.4);
        }

        .trip-btn.saved {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .trip-btn.saved:hover {
            box-shadow: 0 5px 20px rgba(16, 185, 129, 0.4);
        }

        /* Toast notification */
        .trip-toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 1rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 10000;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .trip-toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .trip-toast a {
            color: white;
            text-decoration: none;
            font-weight: 600;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            transition: background 0.2s;
        }

        .trip-toast a:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .cta-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 212, 255, 0.4);
        }

        /* Attractions Accordion */
        .attractions-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .attraction-accordion {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .attraction-accordion:hover {
            border-color: rgba(0, 212, 255, 0.3);
        }

        .attraction-accordion.expanded {
            border-color: rgba(0, 212, 255, 0.5);
            background: rgba(255, 255, 255, 0.08);
        }

        .attraction-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .attraction-header:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .attraction-header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex: 1;
        }

        .attraction-icon {
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 212, 255, 0.15);
            border-radius: 10px;
        }

        .attraction-title {
            font-size: 1rem;
            font-weight: 500;
            color: #fff;
        }

        .attraction-type {
            font-size: 0.75rem;
            color: #00d4ff;
            background: rgba(0, 212, 255, 0.15);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            white-space: nowrap;
            margin-right: 1rem;
        }

        .attraction-toggle {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.6);
            transition: transform 0.3s ease;
        }

        .attraction-accordion.expanded .attraction-toggle {
            transform: rotate(180deg);
            color: #00d4ff;
        }

        .attraction-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .attraction-accordion.expanded .attraction-content {
            max-height: 200px;
        }

        .attraction-details {
            padding: 0 1.25rem 1.25rem 1.25rem;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 1rem;
        }

        /* Tips Section */
        .tips-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .tip-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 1rem 1.25rem;
            background: linear-gradient(145deg, rgba(0, 212, 255, 0.08), rgba(139, 92, 246, 0.08));
            border-left: 3px solid #00d4ff;
            border-radius: 0 12px 12px 0;
        }

        .tip-item::before {
            content: "üí°";
            font-size: 1rem;
        }

        .tip-item p {
            font-size: 0.95rem;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.5;
            margin: 0;
        }

        /* Country Info */
        .country-flag {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .country-code-badge {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background: rgba(0, 212, 255, 0.15);
            border: 2px solid rgba(0, 212, 255, 0.4);
            border-radius: 12px;
            font-size: 1.5rem;
            font-weight: 700;
            color: #00d4ff;
            letter-spacing: 2px;
        }

        .country-details {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .country-detail {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .country-detail:last-child {
            border-bottom: none;
        }

        .country-detail span:first-child {
            color: rgba(255, 255, 255, 0.6);
        }

        /* Best Months */
        .months-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
        }

        .month-tag {
            text-align: center;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            font-size: 0.75rem;
        }

        .month-tag.best {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }

        /* City Map Section */
        .city-map-section {
            margin-top: 2rem;
        }

        .map-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .map-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .map-header h3 {
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0;
        }

        .map-actions {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .map-btn {
            padding: 0.6rem 1.2rem;
            border-radius: 25px;
            border: 1px solid rgba(0, 212, 255, 0.4);
            background: rgba(0, 212, 255, 0.1);
            color: #00d4ff;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .map-btn:hover {
            background: rgba(0, 212, 255, 0.25);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.2);
        }

        .map-btn.active {
            background: rgba(0, 212, 255, 0.3);
            border-color: rgba(0, 212, 255, 0.6);
        }

        .map-btn.download {
            background: rgba(244, 63, 94, 0.15);
            border-color: rgba(244, 63, 94, 0.4);
            color: #f43f5e;
        }

        .map-btn.download:hover {
            background: rgba(244, 63, 94, 0.25);
            box-shadow: 0 5px 15px rgba(244, 63, 94, 0.2);
        }

        #cityMap {
            width: 100%;
            height: 400px;
            border-radius: 16px;
            z-index: 1;
            background: #1a1a2e;
        }

        .map-legend {
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .legend-title {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .legend-items {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.8);
            background: rgba(255, 255, 255, 0.05);
            padding: 0.4rem 0.75rem;
            border-radius: 20px;
        }

        .legend-icon {
            font-size: 1rem;
        }

        /* Custom Leaflet marker styling */
        .custom-marker {
            background: linear-gradient(135deg, #00d4ff 0%, #8b5cf6 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.4);
            border: 2px solid white;
            width: 36px;
            height: 36px;
        }

        .custom-div-icon {
            background: transparent !important;
            border: none !important;
        }

        .leaflet-container {
            background: #e5e3df;
        }

        .marker-popup {
            text-align: center;
        }

        .marker-popup h4 {
            margin: 0 0 0.25rem 0;
            font-size: 0.95rem;
            color: #1a1a2e;
        }

        .marker-popup .popup-type {
            font-size: 0.75rem;
            color: #666;
            text-transform: capitalize;
        }

        .city-center-marker {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e53 100%);
        }

        /* Leaflet popup customization */
        .leaflet-popup-content-wrapper {
            background: white;
            border-radius: 12px;
            box-shadow: 0 3px 14px rgba(0, 0, 0, 0.15);
        }

        .leaflet-popup-content {
            margin: 0.75rem 1rem;
        }

        .leaflet-popup-tip {
            background: white;
        }

        /* Map loading state */
        .map-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 400px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            color: rgba(255, 255, 255, 0.6);
        }

        .map-loading .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(0, 212, 255, 0.2);
            border-top-color: #00d4ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Back Button */
        .back-btn {
            position: absolute;
            top: 80px;
            left: 2rem;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            color: white;
            text-decoration: none;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            z-index: 10;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: rgba(0, 212, 255, 0.3);
        }

        /* Responsive */
        @media (max-width: 992px) {
            .detail-main {
                grid-template-columns: 1fr;
            }

            .detail-sidebar {
                order: -1;
            }
        }

        @media (max-width: 768px) {
            .dest-title {
                font-size: 2rem;
            }

            .detail-hero {
                height: 40vh;
            }

            .detail-main {
                padding: 1rem;
            }

            .quick-info {
                grid-template-columns: 1fr;
            }

            .months-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .budget-grid {
                grid-template-columns: 1fr;
            }

            #cityMap {
                height: 300px;
            }

            .map-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .map-actions {
                width: 100%;
            }

            .map-btn {
                flex: 1;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .dest-title {
                font-size: 1.75rem;
            }

            .dest-subtitle {
                flex-direction: column;
                gap: 0.5rem;
                align-items: flex-start;
            }

            .back-btn {
                top: 70px;
                left: 1rem;
                padding: 0.5rem 1rem;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="page-container">
        <!-- Navigation -->
        <nav class="main-nav">
            <div class="nav-brand">
                <a href="home.html">
                    <svg viewBox="0 0 200 50" class="nav-logo-svg">
                        <text x="5" y="35" class="nav-brand-text">WhereTo</text>
                        <circle cx="175" cy="28" r="6" fill="#ff6b6b" class="nav-pin-dot"/>
                        <circle cx="175" cy="27" r="2.5" fill="white"/>
                        <g class="nav-flying-plane">
                            <path d="M0 0 L-6 -2 L-5 0 L-6 2 Z" fill="#ffffff"/>
                            <path d="M-3 -4 L-1.5 0 L-3 4 L-4 0 Z" fill="#ffffff" opacity="0.7"/>
                        </g>
                        <path class="nav-plane-trail" d="M100 38 Q130 25 150 30 Q170 35 180 22" 
                              fill="none" stroke="rgba(255,255,255,0.4)" stroke-width="1.5" 
                              stroke-dasharray="4 3" stroke-linecap="round"/>
                    </svg>
                </a>
            </div>
            <div class="nav-links">
                <a href="home.html" class="nav-link">üè† Home</a>
                <a href="../nova.html" class="nav-link"><svg class="nav-robot-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="robotHead3" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#00f5ff"/><stop offset="50%" style="stop-color:#8b5cf6"/><stop offset="100%" style="stop-color:#ec4899"/></linearGradient><linearGradient id="robotGlow3" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:#fff;stop-opacity:0.8"/><stop offset="100%" style="stop-color:#fff;stop-opacity:0"/></linearGradient><filter id="neonGlow3"><feGaussianBlur stdDeviation="0.5" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs><rect x="4" y="7" width="16" height="13" rx="4" fill="url(#robotHead3)" filter="url(#neonGlow3)"/><rect x="5" y="8" width="14" height="4" rx="2" fill="url(#robotGlow3)" opacity="0.4"/><rect x="7" y="3" width="10" height="5" rx="2.5" fill="url(#robotHead3)"/><circle cx="8.5" cy="12.5" r="2.5" fill="#0a0a1a"/><circle cx="15.5" cy="12.5" r="2.5" fill="#0a0a1a"/><circle cx="8.5" cy="12.5" r="1.5" fill="#00f5ff"/><circle cx="15.5" cy="12.5" r="1.5" fill="#00f5ff"/><rect x="10" y="16" width="4" height="2" rx="1" fill="#ec4899"/><rect x="11" y="0" width="2" height="4" rx="1" fill="url(#robotHead3)"/><circle cx="12" cy="0" r="1.5" fill="#00f5ff"><animate attributeName="r" values="1.5;2;1.5" dur="1.5s" repeatCount="indefinite"/></circle><rect x="1" y="10" width="3" height="6" rx="1.5" fill="url(#robotHead3)"/><rect x="20" y="10" width="3" height="6" rx="1.5" fill="url(#robotHead3)"/></svg> NOVA</a>
                <a href="destinations.html" class="nav-link active">üåç Destinations</a>
                <a href="trip-planner.html" class="nav-link">üóìÔ∏è Trip Planner</a>
                <a href="visa-guide.html" class="nav-link"><svg class="nav-visa-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 5L20 2V20L4 23Z" fill="#4a90c2"/><path d="M4 5L20 2L21 3L5 6Z" fill="#7fc4e8"/><path d="M20 2L21 3V21L20 20Z" fill="#2d5a87"/><circle cx="12" cy="11" r="4" stroke="#fff" stroke-width="1.2" fill="none"/><line x1="9" y1="14" x2="15" y2="8" stroke="#fff" stroke-width="1.2"/><rect x="7" y="17" width="8" height="1" fill="#fff" opacity="0.6"/></svg> Visa Guide</a>
                <a href="budget-calculator.html" class="nav-link">üí∞ Budget</a>
                <a href="currency-converter.html" class="nav-link">üí± Currency</a>
            </div>
            <button class="nav-toggle" id="navToggle">‚ò∞</button>
        </nav>

        <!-- Hero Section -->
        <section class="detail-hero" id="heroSection">
            <div class="hero-overlay"></div>
            <a href="#" class="back-btn" id="backBtn">‚Üê Back to Country</a>
            <div class="hero-content">
                <div class="breadcrumb">
                    <a href="destinations.html">Destinations</a>
                    <span>‚Ä∫</span>
                    <a href="#" id="regionLink">Region</a>
                    <span>‚Ä∫</span>
                    <a href="#" id="countryLink">Country</a>
                    <span>‚Ä∫</span>
                    <span id="cityBreadcrumb">City</span>
                </div>
                <h1 class="dest-title" id="cityTitle">Loading...</h1>
                <div class="dest-subtitle">
                    <span class="dest-location" id="cityLocation">üìç Loading...</span>
                    <span id="cityPopulation">üë• --</span>
                </div>
            </div>
        </section>

        <!-- Main Content -->
        <main class="detail-main">
            <div class="detail-content">
                <!-- Description -->
                <div class="info-card">
                    <h3>üìù About This Destination</h3>
                    <p class="description-text" id="cityDescription">Loading description...</p>
                </div>

                <!-- Highlights & Attractions -->
                <div class="info-card highlights-section">
                    <h3>‚ú® Highlights & Attractions</h3>
                    <div class="highlights-list" id="highlightsList">
                        <!-- Loaded dynamically -->
                    </div>
                </div>

                <!-- Perfect For -->
                <div class="info-card perfect-for-section">
                    <h3>üéØ Perfect For</h3>
                    <div class="perfect-for-grid" id="perfectForGrid">
                        <!-- Loaded dynamically -->
                    </div>
                </div>

                <!-- Things To Do -->
                <div class="info-card">
                    <h3>üìã Things To Do</h3>
                    <div class="attractions-list" id="attractionsList">
                        <!-- Loaded dynamically -->
                    </div>
                </div>

                <!-- City Map Section -->
                <div class="city-map-section" id="cityMapSection">
                    <div class="map-container">
                        <div class="map-header">
                            <h3>üó∫Ô∏è <span id="mapTitle">City Map</span></h3>
                            <div class="map-actions">
                                <button class="map-btn active" onclick="toggleMapLayer('explore')" id="exploreBtn">
                                    üîç Explore
                                </button>
                                <button class="map-btn" onclick="toggleMapLayer('landmarks')" id="landmarksBtn">
                                    üìç Landmarks
                                </button>
                                <button class="map-btn download" onclick="downloadMap()" id="downloadBtn">
                                    üì∑ Download Map
                                </button>
                            </div>
                        </div>
                        <div id="cityMap">
                            <div class="map-loading">
                                <div class="spinner"></div>
                                <span>Loading map...</span>
                            </div>
                        </div>
                        <div class="map-legend" id="mapLegend">
                            <div class="legend-title">MAP LEGEND</div>
                            <div class="legend-items" id="legendItems">
                                <!-- Populated dynamically -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="detail-sidebar">
                <!-- Ask NOVA Card -->
                <div class="info-card cta-card">
                    <button class="cta-btn" onclick="askNova()">
                        <svg class="nova-btn-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="novaBtnGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#00f5ff"/><stop offset="50%" style="stop-color:#8b5cf6"/><stop offset="100%" style="stop-color:#ec4899"/></linearGradient></defs><rect x="4" y="7" width="16" height="13" rx="4" fill="url(#novaBtnGrad)"/><rect x="7" y="3" width="10" height="5" rx="2.5" fill="url(#novaBtnGrad)"/><circle cx="8.5" cy="12.5" r="2.5" fill="#0a0a1a"/><circle cx="15.5" cy="12.5" r="2.5" fill="#0a0a1a"/><circle cx="8.5" cy="12.5" r="1.5" fill="#00f5ff"/><circle cx="15.5" cy="12.5" r="1.5" fill="#00f5ff"/><rect x="10" y="16" width="4" height="2" rx="1" fill="#ec4899"/></svg>
                        Ask NOVA
                    </button>
                    <button class="trip-btn" id="tripPlannerBtn" onclick="toggleTripPlanner()">
                        <span id="tripBtnIcon">üìå</span> <span id="tripBtnText">Add to Trip Planner</span>
                    </button>
                </div>

                <!-- Quick Info -->
                <div class="info-card">
                    <h3>‚ö° Quick Info</h3>
                    <div class="quick-info">
                        <div class="info-item">
                            <span class="info-label">Best Time</span>
                            <span class="info-value" id="bestTime">--</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Minimum Stay</span>
                            <span class="info-value" id="minStay">--</span>
                        </div>
                    </div>
                </div>

                <!-- Best Months -->
                <div class="info-card">
                    <h3>üìÖ Best Months to Visit</h3>
                    <div class="months-grid" id="monthsGrid">
                        <!-- Loaded dynamically -->
                    </div>
                </div>

                <!-- Country Info -->
                <div class="info-card" id="countryCard">
                    <h3>üåê Country Info</h3>
                    <div style="text-align: center; margin-bottom: 1rem;">
                        <div class="country-code-badge" id="countryCode">--</div>
                        <h4 id="countryName" style="margin-top: 0.5rem;">Loading...</h4>
                    </div>
                    <div class="country-details">
                        <div class="country-detail">
                            <span>Currency</span>
                            <span id="countryCurrency">--</span>
                        </div>
                        <div class="country-detail">
                            <span>Language</span>
                            <span id="countryLanguage">--</span>
                        </div>
                        <div class="country-detail">
                            <span>Visa Policy</span>
                            <span id="visaPolicy">--</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="page-footer">
            <div class="footer-content">
                <div class="footer-brand">
                    <h3>WhereTo</h3>
                    <p>Your Next Journey Starts Here</p>
                </div>
                <div class="footer-links">
                    <a href="../nova.html">NOVA</a>
                    <a href="destinations.html">Destinations</a>
                    <a href="trip-planner.html">Trip Planner</a>
                    <a href="visa-guide.html">Visa Guide</a>
                    <a href="budget-calculator.html">Budget</a>
                    <a href="currency-converter.html">Currency</a>
                </div>
                <div class="footer-bottom">
                    <p>Made with ‚ù§Ô∏è for travelers everywhere</p>
                    <p>¬© 2026 WhereTo. All rights reserved.</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script src="../data/regions-data.js"></script>
    <script>
        // Get IDs from URL
        const urlParams = new URLSearchParams(window.location.search);
        const cityId = urlParams.get('id');
        const countryId = urlParams.get('country');
        const regionId = urlParams.get('region');

        let currentCity = null;
        let currentCountry = null;
        let currentRegion = null;
        let cityMap = null;
        let mapMarkers = [];
        let landmarksVisible = true;

        // Attraction icons based on type
        const typeIcons = {
            'landmark': 'üèõÔ∏è',
            'museum': 'üñºÔ∏è',
            'palace': 'üè∞',
            'castle': 'üè∞',
            'church': '‚õ™',
            'cathedral': '‚õ™',
            'mosque': 'üïå',
            'religious': 'üïç',
            'temple': 'üõï',
            'monastery': 'üïç',
            'park': 'üå≥',
            'garden': 'üå∑',
            'beach': 'üèñÔ∏è',
            'mountain': '‚õ∞Ô∏è',
            'nature': 'üèûÔ∏è',
            'lake': 'üèûÔ∏è',
            'waterfall': 'üí¶',
            'tower': 'üóº',
            'bridge': 'üåâ',
            'market': 'üõí',
            'square': 'üèõÔ∏è',
            'street': 'üõ§Ô∏è',
            'neighborhood': 'üèòÔ∏è',
            'zoo': 'ü¶Å',
            'aquarium': 'üê†',
            'historic': 'üèõÔ∏è',
            'unesco': 'üåç',
            'viewpoint': 'üëÅÔ∏è',
            'food': 'üçΩÔ∏è',
            'shopping': 'üõçÔ∏è',
            'activity': 'üéØ',
            'experience': '‚ú®',
            'default': 'üìç'
        };

        function getAttractionIcon(type) {
            if (!type) return typeIcons.default;
            const typeLower = type.toLowerCase();
            for (const [keyword, icon] of Object.entries(typeIcons)) {
                if (typeLower.includes(keyword)) {
                    return icon;
                }
            }
            return typeIcons.default;
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
            setupNavToggle();
        });

        function initializePage() {
            if (!cityId || !countryId || !regionId) {
                showError('No city specified');
                return;
            }

            // Get city details using the helper function from regions-data.js
            currentCity = getCityDetails(regionId, countryId, cityId);

            if (!currentCity) {
                showError('City not found');
                return;
            }

            // Get region and country info
            const regions = getAllRegions();
            currentRegion = regions.find(r => r.id === regionId);
            const countries = getCountriesByRegion(regionId);
            currentCountry = countries.find(c => c.id === countryId);

            // Update breadcrumbs and links
            const regionLink = document.getElementById('regionLink');
            regionLink.href = `region.html?id=${regionId}`;
            regionLink.textContent = currentRegion ? currentRegion.name : 'Region';

            const countryLink = document.getElementById('countryLink');
            countryLink.href = `country.html?id=${countryId}&region=${regionId}`;
            countryLink.textContent = currentCountry ? currentCountry.name : 'Country';

            document.getElementById('cityBreadcrumb').textContent = currentCity.name;

            // Update back button
            const backBtn = document.getElementById('backBtn');
            backBtn.href = `country.html?id=${countryId}&region=${regionId}`;
            backBtn.textContent = `‚Üê Back to ${currentCountry ? currentCountry.name : 'Country'}`;

            // Update page title
            document.title = `${currentCity.name}, ${currentCity.country} - WhereTo`;

            // Update hero
            document.getElementById('heroSection').style.backgroundImage = `url('${currentCity.image}')`;
            document.getElementById('cityTitle').textContent = currentCity.name;
            document.getElementById('cityLocation').innerHTML = `üìç ${currentCity.country}`;
            document.getElementById('cityPopulation').innerHTML = `‚≠ê ${currentCity.rating || '4.8'}`;

            // Update description
            document.getElementById('cityDescription').textContent = currentCity.description;

            // Update best time
            document.getElementById('bestTime').textContent = formatBestTime(currentCity.bestTime);

            // Update minimum stay
            document.getElementById('minStay').textContent = calculateMinStay(currentCity.attractions);

            // Load highlights from attractions
            loadHighlights(currentCity.attractions);

            // Load "Perfect For" categories
            loadPerfectFor(currentCity.attractions);

            // Load Things To Do (attractions with time estimates)
            loadAttractions(currentCity.attractions);

            // Load months grid
            loadMonthsGrid();

            // Update country info
            if (currentCountry) {
                document.getElementById('countryCode').textContent = getCountryCode(currentCountry.name);
                document.getElementById('countryName').textContent = currentCountry.name;
                document.getElementById('countryCurrency').textContent = extractCurrencyCode(currentCountry.currency);
                document.getElementById('countryLanguage').textContent = currentCountry.language;
                document.getElementById('visaPolicy').textContent = getVisaPolicy(currentCountry.name);
            }

            // Initialize map
            initCityMap();

            // Update trip planner button state
            updateTripPlannerButton();
        }

        // Helper functions for new features
        function formatBestTime(bestTime) {
            if (!bestTime) return '--';
            // Abbreviate months if too long
            const shortened = bestTime
                .replace('September', 'Sep')
                .replace('November', 'Nov')
                .replace('October', 'Oct')
                .replace('December', 'Dec')
                .replace('January', 'Jan')
                .replace('February', 'Feb');
            return shortened.length > 30 ? shortened.split(',')[0] : shortened;
        }

        function calculateMinStay(attractions) {
            if (!attractions || attractions.length === 0) return '2-3 days';
            const count = attractions.length;
            if (count <= 3) return '2-3 days';
            if (count <= 5) return '3-4 days';
            if (count <= 7) return '4-5 days';
            return '5-7 days';
        }

        function getCountryCode(countryName) {
            const codes = {
                'Japan': 'JP', 'France': 'FR', 'Italy': 'IT', 'Spain': 'ES', 'Germany': 'DE',
                'United Kingdom': 'GB', 'United States': 'US', 'Canada': 'CA', 'Australia': 'AU',
                'China': 'CN', 'India': 'IN', 'Brazil': 'BR', 'Mexico': 'MX', 'Thailand': 'TH',
                'Vietnam': 'VN', 'Indonesia': 'ID', 'Malaysia': 'MY', 'Singapore': 'SG',
                'South Korea': 'KR', 'Taiwan': 'TW', 'Hong Kong': 'HK', 'Philippines': 'PH',
                'Greece': 'GR', 'Portugal': 'PT', 'Netherlands': 'NL', 'Belgium': 'BE',
                'Switzerland': 'CH', 'Austria': 'AT', 'Czech Republic': 'CZ', 'Poland': 'PL',
                'Hungary': 'HU', 'Croatia': 'HR', 'Turkey': 'TR', 'Morocco': 'MA',
                'Egypt': 'EG', 'South Africa': 'ZA', 'UAE': 'AE', 'Argentina': 'AR',
                'Peru': 'PE', 'Colombia': 'CO', 'Chile': 'CL', 'New Zealand': 'NZ',
                'Ireland': 'IE', 'Scotland': 'GB', 'Iceland': 'IS', 'Norway': 'NO',
                'Sweden': 'SE', 'Denmark': 'DK', 'Finland': 'FI', 'Russia': 'RU',
                'Albania': 'AL', 'Andorra': 'AD', 'Armenia': 'AM', 'Azerbaijan': 'AZ',
                'Belarus': 'BY', 'Bosnia and Herzegovina': 'BA', 'Bulgaria': 'BG',
                'Cyprus': 'CY', 'Estonia': 'EE', 'Georgia': 'GE', 'Kosovo': 'XK',
                'Latvia': 'LV', 'Liechtenstein': 'LI', 'Lithuania': 'LT', 'Luxembourg': 'LU',
                'Malta': 'MT', 'Moldova': 'MD', 'Monaco': 'MC', 'Montenegro': 'ME',
                'North Macedonia': 'MK', 'Romania': 'RO', 'San Marino': 'SM', 'Serbia': 'RS',
                'Slovakia': 'SK', 'Slovenia': 'SI', 'Ukraine': 'UA', 'Vatican City': 'VA'
            };
            return codes[countryName] || countryName.substring(0, 2).toUpperCase();
        }

        function extractCurrencyCode(currency) {
            if (!currency) return '--';
            // Extract code in parentheses or return as-is
            const match = currency.match(/\(([^)]+)\)/);
            return match ? match[1] : currency;
        }

        function getVisaPolicy(countryName) {
            const visaPolicies = {
                'Japan': 'Visa-free for most nationalities',
                'France': 'Schengen visa required',
                'Italy': 'Schengen visa required',
                'Spain': 'Schengen visa required',
                'Germany': 'Schengen visa required',
                'United Kingdom': 'eVisa available',
                'United States': 'ESTA for visa waiver countries',
                'Thailand': 'Visa on arrival for many',
                'Singapore': 'Visa-free for most',
                'UAE': 'Visa on arrival for many',
                'Australia': 'eVisa (ETA) required',
                'New Zealand': 'NZeTA required',
                'China': 'Visa required',
                'India': 'eVisa available',
                'Brazil': 'Visa-free for many',
                'Mexico': 'Visa-free for many',
                'Turkey': 'eVisa available',
                'Morocco': 'Visa-free for many',
                'Egypt': 'Visa on arrival',
                'South Africa': 'Visa required for some'
            };
            return visaPolicies[countryName] || 'Check requirements';
        }

        function loadHighlights(attractions) {
            const container = document.getElementById('highlightsList');
            
            if (!attractions || attractions.length === 0) {
                container.innerHTML = '<span class="highlight-item">Explore local culture</span>';
                return;
            }

            container.innerHTML = attractions.slice(0, 6).map(attraction => 
                `<span class="highlight-item">${attraction.name}</span>`
            ).join('');
        }

        function loadPerfectFor(attractions) {
            const container = document.getElementById('perfectForGrid');
            
            // Derive categories from attraction types
            const categories = new Set();
            const typeToCategory = {
                'temple': 'cultural', 'shrine': 'cultural', 'museum': 'cultural', 'palace': 'cultural',
                'church': 'cultural', 'cathedral': 'cultural', 'historic': 'history', 'unesco': 'history',
                'castle': 'history', 'monastery': 'cultural',
                'market': 'food', 'food': 'food', 'street': 'food',
                'shopping': 'shopping', 'neighborhood': 'shopping',
                'beach': 'beach', 'nature': 'nature', 'park': 'nature', 'garden': 'nature',
                'mountain': 'adventure', 'waterfall': 'adventure', 'activity': 'adventure',
                'art': 'cultural', 'tower': 'cultural', 'bridge': 'cultural',
                'viewpoint': 'romantic', 'experience': 'adventure'
            };
            const categoryIcons = {
                'cultural': 'üèõÔ∏è', 'food': 'üçú', 'shopping': 'üõçÔ∏è', 'nightlife': 'üåÉ',
                'nature': 'üåø', 'adventure': 'üéØ', 'history': 'üìú', 'beach': 'üèñÔ∏è', 'romantic': 'üíï'
            };
            const categoryLabels = {
                'cultural': 'Cultural', 'food': 'Food & Cuisine', 'shopping': 'Shopping',
                'nightlife': 'Nightlife', 'nature': 'Nature', 'adventure': 'Adventure',
                'history': 'History', 'beach': 'Beach', 'romantic': 'Romantic'
            };

            if (attractions && attractions.length > 0) {
                attractions.forEach(a => {
                    const type = (a.type || '').toLowerCase();
                    for (const [key, cat] of Object.entries(typeToCategory)) {
                        if (type.includes(key)) {
                            categories.add(cat);
                            break;
                        }
                    }
                });
            }

            // Default categories if none found
            if (categories.size === 0) {
                categories.add('cultural');
                categories.add('food');
            }

            // Also add shopping and nightlife for cities with markets or neighborhoods
            if (attractions && attractions.some(a => a.type?.toLowerCase().includes('market'))) {
                categories.add('shopping');
            }

            container.innerHTML = Array.from(categories).slice(0, 4).map(cat => 
                `<span class="perfect-tag ${cat}">${categoryIcons[cat] || '‚ú®'} ${categoryLabels[cat] || cat}</span>`
            ).join('');
        }

        function loadAttractions(attractions) {
            const container = document.getElementById('attractionsList');
            
            if (!attractions || attractions.length === 0) {
                container.innerHTML = '<p style="color: rgba(255,255,255,0.6);">No activities listed yet.</p>';
                return;
            }

            // Time estimates based on attraction type
            const timeEstimates = {
                'temple': '2-3 hours', 'shrine': '1-2 hours', 'museum': '2-4 hours',
                'palace': '2-3 hours', 'castle': '2-3 hours', 'church': '1 hour',
                'cathedral': '1-2 hours', 'park': '2-3 hours', 'garden': '1-2 hours',
                'market': '2-3 hours', 'beach': 'Half day', 'mountain': 'Full day',
                'neighborhood': '3-4 hours', 'street': '2-3 hours', 'tower': '1-2 hours',
                'art': '2-3 hours', 'theme park': 'Full day', 'landmark': '1-2 hours',
                'viewpoint': '1 hour', 'nature': 'Half day', 'waterfall': 'Half day',
                'default': '2-3 hours'
            };

            function getTimeEstimate(type) {
                if (!type) return timeEstimates.default;
                const typeLower = type.toLowerCase();
                for (const [key, time] of Object.entries(timeEstimates)) {
                    if (typeLower.includes(key)) return time;
                }
                return timeEstimates.default;
            }

            container.innerHTML = attractions.map((attraction, index) => `
                <div class="attraction-accordion" data-index="${index}">
                    <div class="attraction-header" onclick="toggleAttraction(${index})">
                        <div class="attraction-header-left">
                            <span class="attraction-icon">${getAttractionIcon(attraction.type)}</span>
                            <span class="attraction-title">${attraction.name}</span>
                        </div>
                        <span class="time-badge">${getTimeEstimate(attraction.type)}</span>
                        <span class="attraction-toggle">‚ñº</span>
                    </div>
                    <div class="attraction-content">
                        <div class="attraction-details">${attraction.description}</div>
                    </div>
                </div>
            `).join('');
        }

        function toggleAttraction(index) {
            const accordion = document.querySelector(`.attraction-accordion[data-index="${index}"]`);
            if (accordion) {
                accordion.classList.toggle('expanded');
            }
        }

        // Map layer toggle functions
        function toggleMapLayer(layer) {
            const exploreBtn = document.getElementById('exploreBtn');
            const landmarksBtn = document.getElementById('landmarksBtn');
            
            if (layer === 'explore') {
                exploreBtn.classList.add('active');
                landmarksBtn.classList.remove('active');
                // Show all markers
                mapMarkers.forEach(m => m.addTo(cityMap));
            } else {
                exploreBtn.classList.remove('active');
                landmarksBtn.classList.add('active');
                // Show only landmark markers
                toggleLandmarks();
            }
        }

        function downloadMap() {
            // Download map as PNG image with title overlay and permanent labels
            const mapContainer = document.getElementById('cityMap');
            const btn = document.getElementById('downloadBtn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '‚è≥ Capturing...';
            btn.disabled = true;
            
            // Create title overlay at top left
            const titleOverlay = document.createElement('div');
            titleOverlay.id = 'mapTitleOverlay';
            titleOverlay.style.cssText = 'position:absolute;top:10px;left:10px;background:rgba(15,15,35,0.95);color:white;padding:12px 24px;border-radius:12px;font-weight:bold;font-size:18px;z-index:1000;display:flex;align-items:center;gap:10px;font-family:Poppins,sans-serif;box-shadow:0 4px 20px rgba(0,0,0,0.3);';
            titleOverlay.innerHTML = `üìç ${currentCity.name} City Map`;
            mapContainer.appendChild(titleOverlay);
            
            // Create WhereTo watermark at bottom right
            const watermark = document.createElement('div');
            watermark.id = 'mapWatermark';
            watermark.style.cssText = 'position:absolute;bottom:10px;right:10px;background:rgba(15,15,35,0.95);color:#00d4ff;padding:10px 20px;border-radius:8px;font-weight:bold;font-size:16px;z-index:1000;font-family:Poppins,sans-serif;box-shadow:0 4px 20px rgba(0,0,0,0.3);';
            watermark.innerHTML = 'WhereTo';
            mapContainer.appendChild(watermark);
            
            // Add permanent labels to all markers
            const labels = [];
            mapMarkers.forEach((marker, index) => {
                const latlng = marker.getLatLng();
                const popup = marker.getPopup();
                if (popup) {
                    const content = popup.getContent();
                    const match = content.match(/<h4>(.+?)<\/h4>/);
                    if (match) {
                        const labelText = match[1].replace(/<[^>]*>/g, '');
                        const colors = ['#ec4899', '#8b5cf6', '#f97316', '#14b8a6', '#06b6d4', '#a855f7'];
                        const color = index === 0 ? '#f97316' : colors[index % colors.length];
                        
                        const label = document.createElement('div');
                        label.className = 'map-label-permanent';
                        label.style.cssText = `position:absolute;background:${color};color:white;padding:6px 12px;border-radius:8px;font-weight:600;font-size:12px;z-index:999;white-space:nowrap;box-shadow:0 3px 10px rgba(0,0,0,0.3);font-family:Inter,sans-serif;transform:translate(-50%,-100%);`;
                        label.innerHTML = labelText;
                        
                        const point = cityMap.latLngToContainerPoint(latlng);
                        label.style.left = point.x + 'px';
                        label.style.top = (point.y - 25) + 'px';
                        
                        mapContainer.appendChild(label);
                        labels.push(label);
                    }
                }
            });
            
            setTimeout(() => {
                html2canvas(mapContainer, {
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: null,
                    scale: 2
                }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = `${currentCity.name}-map-whereto.png`;
                    link.href = canvas.toDataURL('image/png', 1.0);
                    link.click();
                    
                    // Cleanup
                    titleOverlay.remove();
                    watermark.remove();
                    labels.forEach(l => l.remove());
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }).catch(err => {
                    console.error('Map download failed:', err);
                    titleOverlay.remove();
                    watermark.remove();
                    labels.forEach(l => l.remove());
                    // Fallback to OpenStreetMap
                    const cityCoords = getCityCoordinates(currentCity.name, currentCity.country);
                    if (cityCoords) {
                        window.open(`https://www.openstreetmap.org/#map=14/${cityCoords[0]}/${cityCoords[1]}`, '_blank');
                    }
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                });
            }, 300);
        }

        function loadMonthsGrid() {
            const monthsGrid = document.getElementById('monthsGrid');
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            
            // Parse best time to determine best months
            const bestTime = currentCity.bestTime ? currentCity.bestTime.toLowerCase() : '';
            const bestMonths = [];
            
            const monthMap = {
                'january': 0, 'february': 1, 'march': 2, 'april': 3, 'may': 4, 'june': 5,
                'july': 6, 'august': 7, 'september': 8, 'october': 9, 'november': 10, 'december': 11,
                'jan': 0, 'feb': 1, 'mar': 2, 'apr': 3, 'jun': 5, 'jul': 6, 'aug': 7, 'sep': 8, 'oct': 9, 'nov': 10, 'dec': 11
            };
            
            for (const [name, idx] of Object.entries(monthMap)) {
                if (bestTime.includes(name)) {
                    bestMonths.push(idx);
                }
            }

            monthsGrid.innerHTML = months.map((month, index) => {
                const isBest = bestMonths.includes(index);
                return `<div class="month-tag ${isBest ? 'best' : ''}">${month}</div>`;
            }).join('');
        }

        // ============================================
        // MAP FUNCTIONALITY
        // ============================================
        function initCityMap() {
            // Get coordinates from city name using a simple lookup
            const cityCoords = getCityCoordinates(currentCity.name, currentCity.country);
            
            if (!cityCoords) {
                document.getElementById('cityMapSection').style.display = 'none';
                return;
            }

            // Update map title
            document.getElementById('mapTitle').textContent = `${currentCity.name} Map`;

            // Clear loading state
            const mapContainer = document.getElementById('cityMap');
            mapContainer.innerHTML = '';

            setTimeout(() => {
                cityMap = L.map('cityMap', {
                    center: cityCoords,
                    zoom: 13,
                    zoomControl: true,
                    scrollWheelZoom: true
                });

                // Add OpenStreetMap tiles
                L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
                    maxZoom: 19
                }).addTo(cityMap);

                // Add city center marker
                const centerMarker = L.marker(cityCoords, {
                    icon: createCustomIcon('üìç', 'city-center-marker')
                }).addTo(cityMap);
                centerMarker.bindPopup(`
                    <div class="marker-popup">
                        <h4>${currentCity.name}</h4>
                        <div class="popup-type">City Center</div>
                    </div>
                `);
                mapMarkers.push(centerMarker);

                // Add attraction markers if we have coordinates
                if (currentCity.attractions && currentCity.attractions.length > 0) {
                    addAttractionMarkers(cityCoords);
                }

                // Add airport marker if available
                addAirportMarker(cityCoords);

                // Update legend
                updateMapLegend();

                setTimeout(() => {
                    cityMap.invalidateSize();
                    cityMap.setView(cityCoords, 13);
                }, 200);
            }, 100);
        }

        function createCustomIcon(emoji, extraClass = '') {
            return L.divIcon({
                html: `<div class="custom-marker ${extraClass}">${emoji}</div>`,
                className: 'custom-div-icon',
                iconSize: [40, 40],
                iconAnchor: [20, 40],
                popupAnchor: [0, -40]
            });
        }

        function addAttractionMarkers(centerCoords) {
            // Get landmark data if available, otherwise place in a spread pattern
            const landmarks = getLandmarkCoordinates(currentCity.name);
            
            if (landmarks && Object.keys(landmarks).length > 0) {
                // Use real landmark coordinates
                currentCity.attractions.forEach((attraction) => {
                    const landmarkCoords = landmarks[attraction.name];
                    if (landmarkCoords) {
                        const marker = L.marker(landmarkCoords, {
                            icon: createCustomIcon(getAttractionIcon(attraction.type))
                        }).addTo(cityMap);
                        
                        marker.bindPopup(`
                            <div class="marker-popup">
                                <h4>${getAttractionIcon(attraction.type)} ${attraction.name}</h4>
                                <div class="popup-type">${attraction.type || 'Attraction'}</div>
                            </div>
                        `);
                        
                        mapMarkers.push(marker);
                    }
                });
            }
            
            // Place remaining attractions in a spread pattern around center
            const placedNames = landmarks ? Object.keys(landmarks) : [];
            const unplacedAttractions = currentCity.attractions.filter(a => !placedNames.includes(a.name));
            
            if (unplacedAttractions.length > 0) {
                // Use varied radii for more natural spread
                const baseRadius = 0.015; // ~1.5km
                unplacedAttractions.forEach((attraction, index) => {
                    const angle = (index / unplacedAttractions.length) * 2 * Math.PI + (Math.random() * 0.3);
                    const radiusVariation = baseRadius * (0.5 + Math.random() * 0.8);
                    const lat = centerCoords[0] + radiusVariation * Math.cos(angle);
                    const lng = centerCoords[1] + radiusVariation * Math.sin(angle) * 1.3;
                    
                    const marker = L.marker([lat, lng], {
                        icon: createCustomIcon(getAttractionIcon(attraction.type))
                    }).addTo(cityMap);
                    
                    marker.bindPopup(`
                        <div class="marker-popup">
                            <h4>${getAttractionIcon(attraction.type)} ${attraction.name}</h4>
                            <div class="popup-type">${attraction.type || 'Attraction'}</div>
                        </div>
                    `);
                    
                    mapMarkers.push(marker);
                });
            }
        }

        // Landmark coordinates for major cities
        function getLandmarkCoordinates(cityName) {
            const landmarks = {
                'Paris': {
                    'Eiffel Tower': [48.8584, 2.2945],
                    'Louvre Museum': [48.8606, 2.3376],
                    'Notre-Dame': [48.8530, 2.3499],
                    'Arc de Triomphe': [48.8738, 2.2950],
                    'Sacr√©-C≈ìur': [48.8867, 2.3431],
                    'Champs-√âlys√©es': [48.8698, 2.3075],
                    'Montmartre': [48.8867, 2.3431]
                },
                'London': {
                    'Big Ben': [51.5007, -0.1246],
                    'Tower of London': [51.5081, -0.0759],
                    'Buckingham Palace': [51.5014, -0.1419],
                    'British Museum': [51.5194, -0.1270],
                    'London Eye': [51.5033, -0.1196],
                    'Tower Bridge': [51.5055, -0.0754],
                    'Westminster Abbey': [51.4994, -0.1273]
                },
                'Rome': {
                    'Colosseum': [41.8902, 12.4922],
                    'Vatican City': [41.9029, 12.4534],
                    'Trevi Fountain': [41.9009, 12.4833],
                    'Pantheon': [41.8986, 12.4769],
                    'Roman Forum': [41.8925, 12.4853],
                    'Spanish Steps': [41.9060, 12.4828],
                    'St. Peter\'s Basilica': [41.9022, 12.4539]
                },
                'Tokyo': {
                    'Shibuya Crossing': [35.6595, 139.7004],
                    'Senso-ji Temple': [35.7148, 139.7967],
                    'Tokyo Tower': [35.6586, 139.7454],
                    'Meiji Shrine': [35.6764, 139.6993],
                    'Tokyo Skytree': [35.7101, 139.8107],
                    'Imperial Palace': [35.6852, 139.7528],
                    'Shinjuku': [35.6896, 139.6917]
                },
                'New York': {
                    'Statue of Liberty': [40.6892, -74.0445],
                    'Central Park': [40.7829, -73.9654],
                    'Times Square': [40.7580, -73.9855],
                    'Empire State Building': [40.7484, -73.9857],
                    'Brooklyn Bridge': [40.7061, -73.9969],
                    'One World Trade Center': [40.7127, -74.0134]
                },
                'Dubai': {
                    'Burj Khalifa': [25.1972, 55.2744],
                    'Palm Jumeirah': [25.1124, 55.1390],
                    'Dubai Mall': [25.1985, 55.2796],
                    'Burj Al Arab': [25.1412, 55.1853],
                    'Dubai Marina': [25.0805, 55.1403],
                    'Dubai Frame': [25.2354, 55.3005]
                },
                'Barcelona': {
                    'Sagrada Familia': [41.4036, 2.1744],
                    'Park G√ºell': [41.4145, 2.1527],
                    'La Rambla': [41.3797, 2.1734],
                    'Casa Batll√≥': [41.3916, 2.1650],
                    'Gothic Quarter': [41.3833, 2.1761],
                    'Camp Nou': [41.3809, 2.1228]
                },
                'Amsterdam': {
                    'Anne Frank House': [52.3752, 4.8840],
                    'Rijksmuseum': [52.3600, 4.8852],
                    'Van Gogh Museum': [52.3584, 4.8811],
                    'Dam Square': [52.3731, 4.8932],
                    'Canal Ring': [52.3676, 4.9041],
                    'Vondelpark': [52.3579, 4.8686]
                },
                'Vienna': {
                    'Sch√∂nbrunn Palace': [48.1845, 16.3122],
                    'St. Stephen\'s Cathedral': [48.2082, 16.3738],
                    'Belvedere Palace': [48.1914, 16.3805],
                    'Hofburg Palace': [48.2064, 16.3649],
                    'Vienna State Opera': [48.2034, 16.3689]
                },
                'Singapore': {
                    'Marina Bay Sands': [1.2834, 103.8607],
                    'Gardens by the Bay': [1.2816, 103.8636],
                    'Sentosa Island': [1.2494, 103.8303],
                    'Orchard Road': [1.3048, 103.8318],
                    'Merlion Park': [1.2868, 103.8545],
                    'Chinatown': [1.2839, 103.8443]
                },
                'Bangkok': {
                    'Grand Palace': [13.7500, 100.4914],
                    'Wat Pho': [13.7465, 100.4927],
                    'Wat Arun': [13.7437, 100.4888],
                    'Chatuchak Market': [13.7999, 100.5506],
                    'Khao San Road': [13.7582, 100.4971]
                },
                'Istanbul': {
                    'Hagia Sophia': [41.0086, 28.9802],
                    'Blue Mosque': [41.0054, 28.9768],
                    'Topkapi Palace': [41.0115, 28.9833],
                    'Grand Bazaar': [41.0106, 28.9680],
                    'Galata Tower': [41.0256, 28.9741],
                    'Bosphorus': [41.0411, 29.0083]
                },
                'Sydney': {
                    'Sydney Opera House': [-33.8568, 151.2153],
                    'Sydney Harbour Bridge': [-33.8523, 151.2108],
                    'Bondi Beach': [-33.8915, 151.2767],
                    'Darling Harbour': [-33.8723, 151.1987],
                    'The Rocks': [-33.8590, 151.2085]
                },
                'Prague': {
                    'Charles Bridge': [50.0865, 14.4114],
                    'Prague Castle': [50.0911, 14.4017],
                    'Old Town Square': [50.0875, 14.4213],
                    'Astronomical Clock': [50.0870, 14.4206],
                    'St. Vitus Cathedral': [50.0909, 14.4006]
                }
            };
            return landmarks[cityName] || null;
        }

        // Airport coordinates for major cities
        function getAirportCoordinates(cityName) {
            const airports = {
                'Paris': { name: 'Charles de Gaulle Airport', coords: [49.0097, 2.5479] },
                'London': { name: 'Heathrow Airport', coords: [51.4700, -0.4543] },
                'Tokyo': { name: 'Narita Airport', coords: [35.7720, 140.3929] },
                'Bangkok': { name: 'Suvarnabhumi Airport', coords: [13.6900, 100.7501] },
                'Singapore': { name: 'Changi Airport', coords: [1.3644, 103.9915] },
                'Dubai': { name: 'Dubai International', coords: [25.2532, 55.3657] },
                'New York': { name: 'JFK Airport', coords: [40.6413, -73.7781] },
                'Barcelona': { name: 'El Prat Airport', coords: [41.2974, 2.0833] },
                'Rome': { name: 'Fiumicino Airport', coords: [41.8003, 12.2389] },
                'Amsterdam': { name: 'Schiphol Airport', coords: [52.3105, 4.7683] },
                'Sydney': { name: 'Sydney Airport', coords: [-33.9461, 151.1772] },
                'Hong Kong': { name: 'Hong Kong International', coords: [22.3080, 113.9185] },
                'Seoul': { name: 'Incheon Airport', coords: [37.4602, 126.4407] },
                'Istanbul': { name: 'Istanbul Airport', coords: [41.2619, 28.7246] },
                'Madrid': { name: 'Barajas Airport', coords: [40.4983, -3.5676] },
                'Munich': { name: 'Munich Airport', coords: [48.3537, 11.7750] },
                'Berlin': { name: 'Berlin Brandenburg', coords: [52.3667, 13.5033] },
                'Milan': { name: 'Malpensa Airport', coords: [45.6306, 8.7281] },
                'Vienna': { name: 'Vienna Airport', coords: [48.1103, 16.5697] },
                'Prague': { name: 'V√°clav Havel Airport', coords: [50.1008, 14.2600] },
                'Lisbon': { name: 'Lisbon Airport', coords: [38.7756, -9.1354] },
                'Athens': { name: 'Athens Airport', coords: [37.9364, 23.9475] },
                'Zurich': { name: 'Zurich Airport', coords: [47.4647, 8.5492] },
                'Venice': { name: 'Marco Polo Airport', coords: [45.5053, 12.3519] },
                'Florence': { name: 'Florence Airport', coords: [43.8100, 11.2051] },
                'Kyoto': { name: 'Kansai Airport', coords: [34.4320, 135.2304] },
                'Osaka': { name: 'Kansai Airport', coords: [34.4320, 135.2304] },
                'Bali': { name: 'Ngurah Rai Airport', coords: [-8.7482, 115.1672] },
                'Phuket': { name: 'Phuket Airport', coords: [8.1132, 98.3169] },
                'Kuala Lumpur': { name: 'KLIA Airport', coords: [2.7456, 101.7072] },
                'Mumbai': { name: 'Mumbai Airport', coords: [19.0896, 72.8656] },
                'Delhi': { name: 'Indira Gandhi Airport', coords: [28.5562, 77.1000] },
                'Cairo': { name: 'Cairo Airport', coords: [30.1219, 31.4056] },
                'Marrakech': { name: 'Menara Airport', coords: [31.6069, -8.0363] },
                'Cape Town': { name: 'Cape Town Airport', coords: [-33.9715, 18.6021] },
                'Johannesburg': { name: 'OR Tambo Airport', coords: [-26.1392, 28.2460] },
                'Rio de Janeiro': { name: 'Gale√£o Airport', coords: [-22.8099, -43.2505] },
                'Buenos Aires': { name: 'Ezeiza Airport', coords: [-34.8222, -58.5358] },
                'Mexico City': { name: 'Mexico City Airport', coords: [19.4361, -99.0719] },
                'Los Angeles': { name: 'LAX Airport', coords: [33.9425, -118.4081] },
                'San Francisco': { name: 'SFO Airport', coords: [37.6213, -122.3790] },
                'Miami': { name: 'Miami Airport', coords: [25.7959, -80.2870] },
                'Toronto': { name: 'Pearson Airport', coords: [43.6777, -79.6248] },
                'Vancouver': { name: 'Vancouver Airport', coords: [49.1967, -123.1815] }
            };
            return airports[cityName] || null;
        }

        function addAirportMarker(centerCoords) {
            const airport = getAirportCoordinates(currentCity.name);
            if (airport) {
                const marker = L.marker(airport.coords, {
                    icon: createCustomIcon('‚úàÔ∏è')
                }).addTo(cityMap);
                
                marker.bindPopup(`
                    <div class="marker-popup">
                        <h4>‚úàÔ∏è ${airport.name}</h4>
                        <div class="popup-type">International Airport</div>
                    </div>
                `);
                
                mapMarkers.push(marker);
            }
        }

        function updateMapLegend() {
            const legendItems = document.getElementById('legendItems');
            
            // Fixed legend items matching the standard icons
            legendItems.innerHTML = `
                <div class="legend-item">
                    <span class="legend-icon">üìç</span>
                    <span>City Center</span>
                </div>
                <div class="legend-item">
                    <span class="legend-icon">üóº</span>
                    <span>Major Landmark</span>
                </div>
                <div class="legend-item">
                    <span class="legend-icon">üñºÔ∏è</span>
                    <span>Museum</span>
                </div>
                <div class="legend-item">
                    <span class="legend-icon">‚õ™</span>
                    <span>Religious Site</span>
                </div>
                <div class="legend-item">
                    <span class="legend-icon">üèõÔ∏è</span>
                    <span>Monument</span>
                </div>
                <div class="legend-item">
                    <span class="legend-icon">üè¨</span>
                    <span>Shopping Area</span>
                </div>
                <div class="legend-item">
                    <span class="legend-icon">üè∞</span>
                    <span>Palace</span>
                </div>
                <div class="legend-item">
                    <span class="legend-icon">üéØ</span>
                    <span>District</span>
                </div>
                <div class="legend-item">
                    <span class="legend-icon">üå≥</span>
                    <span>Park & Garden</span>
                </div>
                <div class="legend-item">
                    <span class="legend-icon">‚úàÔ∏è</span>
                    <span>Airport</span>
                </div>
            `;
        }

        function resetMapView() {
            if (cityMap && currentCity) {
                const coords = getCityCoordinates(currentCity.name, currentCity.country);
                if (coords) {
                    cityMap.setView(coords, 13);
                }
            }
        }

        function toggleLandmarks() {
            landmarksVisible = !landmarksVisible;
            const btn = document.getElementById('toggleLandmarksBtn');
            
            mapMarkers.forEach((marker, index) => {
                if (index === 0) return; // Skip city center
                
                if (landmarksVisible) {
                    marker.addTo(cityMap);
                } else {
                    cityMap.removeLayer(marker);
                }
            });
            
            btn.innerHTML = landmarksVisible ? 'üìç Landmarks' : 'üìç Show All';
            btn.style.opacity = landmarksVisible ? '1' : '0.6';
        }

        // City coordinates lookup - All 340 cities
        function getCityCoordinates(cityName, country) {
            const coords = {
                // SCHENGEN AREA CITIES
                'Tirana': [41.3275, 19.8187],
                'Vienna': [48.2082, 16.3738],
                'Salzburg': [47.8095, 13.0550],
                'Innsbruck': [47.2692, 11.4041],
                'Graz': [47.0707, 15.4395],
                'Linz': [48.3069, 14.2858],
                'Minsk': [53.9045, 27.5615],
                'Brussels': [50.8503, 4.3517],
                'Antwerp': [51.2194, 4.4025],
                'Ghent': [51.0543, 3.7174],
                'Sarajevo': [43.8563, 18.4131],
                'Sofia': [42.6977, 23.3219],
                'Zagreb': [45.8150, 15.9819],
                'Split': [43.5081, 16.4402],
                'Dubrovnik': [42.6507, 18.0944],
                'Nicosia (Lefkosia)': [35.1856, 33.3823],
                'Prague': [50.0755, 14.4378],
                'Tallinn': [59.4370, 24.7536],
                'Riga': [56.9496, 24.1052],
                'Vaduz': [47.1410, 9.5209],
                'Vilnius': [54.6872, 25.2797],
                'Luxembourg City': [49.6116, 6.1319],
                'Valletta': [35.8989, 14.5146],
                'Gozo': [36.0440, 14.2514],
                'Chi»ôinƒÉu': [47.0105, 28.8638],
                'Monte Carlo': [43.7384, 7.4246],
                'Kotor': [42.4247, 18.7712],
                'Budva': [42.2911, 18.8403],
                'Amsterdam': [52.3676, 4.9041],
                'Rotterdam': [51.9244, 4.4777],
                'Skopje': [41.9973, 21.4280],
                'Ohrid': [41.1231, 20.8016],
                'Krak√≥w': [50.0647, 19.9450],
                'Warsaw': [52.2297, 21.0122],
                'Gda≈Ñsk': [54.3520, 18.6466],
                'Lisbon': [38.7223, -9.1393],
                'Porto': [41.1579, -8.6291],
                'Algarve': [37.0179, -7.9304],
                'Bucharest': [44.4268, 26.1025],
                'Bra»ôov': [45.6427, 25.5887],
                'Belgrade': [44.7866, 20.4489],
                'Novi Sad': [45.2671, 19.8335],
                'Bratislava': [48.1486, 17.1077],
                'High Tatras': [49.1399, 20.0631],
                'Kyiv': [50.4501, 30.5234],
                'Lviv': [49.8397, 24.0297],
                'London': [51.5074, -0.1278],
                'Edinburgh': [55.9533, -3.1883],
                'Cotswolds': [51.8330, -1.7833],
                'Manchester': [53.4808, -2.2426],
                'Liverpool': [53.4084, -2.9916],
                'Glasgow': [55.8642, -4.2518],
                'Birmingham': [52.4862, -1.8904],
                'Ljubljana': [46.0569, 14.5058],
                'Lake Bled': [46.3683, 14.1146],
                'Barcelona': [41.3851, 2.1734],
                'Madrid': [40.4168, -3.7038],
                'Seville': [37.3891, -5.9845],
                'Valencia': [39.4699, -0.3763],
                'Zaragoza': [41.6488, -0.8891],
                'Zurich': [47.3769, 8.5417],
                'Zermatt': [46.0207, 7.7491],
                'Lucerne': [47.0502, 8.3093],
                'Geneva': [46.2044, 6.1432],
                'Lausanne': [46.5197, 6.6323],
                'Bern': [46.9480, 7.4474],
                'Paris': [48.8566, 2.3522],
                'Lyon': [45.7640, 4.8357],
                'Marseille': [43.2965, 5.3698],
                'Nice': [43.7102, 7.2620],
                'Bordeaux': [44.8378, -0.5792],
                'Cannes': [43.5528, 7.0174],
                'Toulouse': [43.6047, 1.4442],
                'Berlin': [52.5200, 13.4050],
                'Munich': [48.1351, 11.5820],
                'Frankfurt': [50.1109, 8.6821],
                'Hamburg': [53.5511, 9.9937],
                'Cologne': [50.9375, 6.9603],
                'D√ºsseldorf': [51.2277, 6.7735],
                'Stuttgart': [48.7758, 9.1829],
                'Athens': [37.9838, 23.7275],
                'Santorini': [36.3932, 25.4615],
                'Crete': [35.2401, 24.8093],
                'Thessaloniki': [40.6401, 22.9444],
                'Mykonos': [37.4467, 25.3289],
                'Budapest': [47.4979, 19.0402],
                'Eger': [47.9025, 20.3772],
                'Dublin': [53.3498, -6.2603],
                'Galway': [53.2707, -9.0568],
                'Cork': [51.8985, -8.4756],
                'Rome': [41.9028, 12.4964],
                'Florence': [43.7696, 11.2558],
                'Venice': [45.4408, 12.3155],
                'Milan': [45.4642, 9.1900],
                'Naples': [40.8518, 14.2681],
                'Amalfi Coast': [40.6340, 14.6027],
                'Palermo': [38.1157, 13.3615],
                'Capri': [40.5507, 14.2224],
                'Tuscany': [43.4713, 11.1544],

                // NORDIC CITIES
                'Copenhagen': [55.6761, 12.5683],
                'Aarhus': [56.1629, 10.2039],
                'Aalborg': [57.0488, 9.9217],
                'Helsinki': [60.1699, 24.9384],
                'Turku': [60.4518, 22.2666],
                'Rovaniemi': [66.5039, 25.7294],
                'Reykjavik': [64.1466, -21.9426],
                'V√≠k √≠ M√Ωrdal': [63.4186, -19.0060],
                'Oslo': [59.9139, 10.7522],
                'Bergen': [60.3913, 5.3221],
                'Troms√∏': [69.6492, 18.9553],
                'Stockholm': [59.3293, 18.0686],
                'Gothenburg': [57.7089, 11.9746],

                // AMERICAS CITIES
                'Buenos Aires': [-34.6037, -58.3816],
                'La Paz': [-16.4897, -68.1193],
                'Rio de Janeiro': [-22.9068, -43.1729],
                'S√£o Paulo': [-23.5505, -46.6333],
                'Bogot√°': [4.7110, -74.0721],
                'Medell√≠n': [6.2442, -75.5812],
                'Quito': [-0.1807, -78.4678],
                'Panama City': [8.9824, -79.5199],
                'Bocas del Toro': [9.3404, -82.2419],
                'Lima': [-12.0464, -77.0428],
                'Cusco': [-13.5320, -71.9675],
                'Arequipa': [-16.4090, -71.5375],
                'Caracas': [10.4806, -66.9036],
                'Canaima & Angel Falls': [5.9675, -62.5342],
                'Toronto': [43.6532, -79.3832],
                'Montreal': [45.5017, -73.5673],
                'Vancouver': [49.2827, -123.1207],
                'Calgary': [51.0447, -114.0719],
                'San Jos√©': [9.9281, -84.0907],
                'Antigua Guatemala': [14.5586, -90.7295],
                'Roat√°n': [16.3285, -86.5465],
                'Montego Bay': [18.4762, -77.8939],
                'Negril': [18.2682, -78.3476],
                'Mexico City': [19.4326, -99.1332],
                'Canc√∫n': [21.1619, -86.8515],
                'Oaxaca': [17.0732, -96.7266],
                'New York City': [40.7128, -74.0060],
                'New York': [40.7128, -74.0060],
                'Los Angeles': [34.0522, -118.2437],
                'Las Vegas': [36.1699, -115.1398],
                'Washington, D.C.': [38.9072, -77.0369],
                'San Francisco': [37.7749, -122.4194],
                'Orlando': [28.5383, -81.3792],
                'Niagara Falls': [43.0962, -79.0377],
                'Granada': [11.9344, -85.9560],
                'Le√≥n': [12.4379, -86.8780],

                // CENTRAL ASIA CITIES
                'Yerevan': [40.1792, 44.4991],
                'Baku': [40.4093, 49.8671],
                'Gabala': [40.9826, 47.8628],
                'Sheki': [41.1975, 47.1706],
                'Ganja': [40.6828, 46.3606],
                'Lankaran': [38.7530, 48.8510],
                'Tbilisi': [41.7151, 44.8271],
                'Batumi': [41.6168, 41.6367],
                'Astana': [51.1694, 71.4491],
                'Almaty': [43.2220, 76.8512],
                'Bishkek': [42.8746, 74.5698],
                'Issyk-Kul': [42.4500, 77.2500],
                'Dushanbe': [38.5598, 68.7740],
                'Pamir Highway': [38.3333, 72.5000],
                'Ashgabat': [37.9601, 58.3261],
                'Darvaza Gas Crater': [40.2526, 58.4397],
                'Tashkent': [41.2995, 69.2401],
                'Samarkand': [39.6270, 66.9750],
                'Bukhara': [39.7747, 64.4286],

                // OCEANIA CITIES
                'Sydney': [-33.8688, 151.2093],
                'Melbourne': [-37.8136, 144.9631],
                'Brisbane': [-27.4698, 153.0251],
                'Gold Coast': [-28.0167, 153.4000],
                'Perth': [-31.9505, 115.8605],
                'Cairns': [-16.9186, 145.7781],
                'Canberra': [-35.2809, 149.1300],
                'Suva': [-18.1416, 178.4415],
                'Queenstown': [-45.0312, 168.6626],
                'Auckland': [-36.8485, 174.7633],
                'Rotorua': [-38.1368, 176.2497],
                'Wellington': [-41.2865, 174.7762],
                'Christchurch': [-43.5321, 172.6362],
                'Franz Josef': [-43.3876, 170.1830],
                'Bora Bora': [-16.5004, -151.7415],
                'Tahiti': [-17.6509, -149.4260],
                'Moorea': [-17.5388, -149.8295],
                'Port Moresby': [-9.4438, 147.1803],

                // ASIA CITIES
                'Phnom Penh': [11.5564, 104.9282],
                'Siem Reap': [13.3671, 103.8448],
                'Beijing': [39.9042, 116.4074],
                'Shanghai': [31.2304, 121.4737],
                'Guangzhou': [23.1291, 113.2644],
                'Shenzhen': [22.5431, 114.0579],
                'Wuhan': [30.5928, 114.3055],
                'Manama': [26.2285, 50.5860],
                'Bandar Seri Begawan': [4.9031, 114.9398],
                'Delhi': [28.7041, 77.1025],
                'New Delhi': [28.6139, 77.2090],
                'Agra': [27.1767, 78.0081],
                'Jaipur': [26.9124, 75.7873],
                'Mumbai': [19.0760, 72.8777],
                'Goa': [15.2993, 74.1240],
                'Bali': [-8.3405, 115.0920],
                'Jakarta': [-6.2088, 106.8456],
                'Yogyakarta': [-7.7956, 110.3695],
                'Tokyo': [35.6762, 139.6503],
                'Kyoto': [35.0116, 135.7681],
                'Osaka': [34.6937, 135.5023],
                'Hiroshima': [34.3853, 132.4553],
                'Yokohama': [35.4437, 139.6380],
                'Kobe': [34.6901, 135.1956],
                'Luang Prabang': [19.8867, 102.1350],
                'Vientiane': [17.9757, 102.6331],
                'Kuala Lumpur': [3.1390, 101.6869],
                'Penang': [5.4141, 100.3288],
                'Langkawi': [6.3500, 99.8000],
                'Genting Highlands': [3.4236, 101.7932],
                'Malacca': [2.1896, 102.2501],
                'Johor Bahru': [1.4927, 103.7414],
                'Kuching': [1.5535, 110.3593],
                'Mal√©': [4.1755, 73.5093],
                'Resort Islands': [4.2167, 73.7500],
                'Ulaanbaatar': [47.8864, 106.9057],
                'Gobi Desert': [42.5000, 105.0000],
                'Bagan': [21.1717, 94.8585],
                'Yangon': [16.8661, 96.1951],
                'Kathmandu': [27.7172, 85.3240],
                'Pokhara': [28.2096, 83.9856],
                'Everest Region': [27.9881, 86.9250],
                'Lahore': [31.5204, 74.3587],
                'Hunza Valley': [36.3167, 74.6500],
                'Manila': [14.5995, 120.9842],
                'Palawan': [9.8349, 118.7384],
                'Bohol': [9.8500, 124.0000],
                'Cebu': [10.3157, 123.8854],
                'Boracay': [11.9674, 121.9248],
                'Angeles City': [15.1450, 120.5887],
                'Moscow': [55.7558, 37.6173],
                'St. Petersburg': [59.9311, 30.3609],
                'Singapore': [1.3521, 103.8198],
                'Changi Jewel': [1.3604, 103.9896],
                'Seoul': [37.5665, 126.9780],
                'Busan': [35.1796, 129.0756],
                'Colombo': [6.9271, 79.8612],
                'Kandy': [7.2906, 80.6337],
                'Ella': [6.8667, 81.0466],
                'Galle': [6.0535, 80.2210],
                'Bentota': [6.4213, 79.9978],
                'Yala': [6.3728, 81.5197],
                'Jaffna': [9.6615, 80.0255],
                'Taipei': [25.0330, 121.5654],
                'Taroko Gorge': [24.1589, 121.4950],
                'Bangkok': [13.7563, 100.5018],
                'Chiang Mai': [18.7883, 98.9853],
                'Krabi': [8.0863, 98.9063],
                'Phuket': [7.8804, 98.3923],
                'Pattaya': [12.9236, 100.8825],
                'Koh Samui': [9.5120, 100.0134],
                'Koh Phangan': [9.7500, 100.0333],
                'Chiang Rai': [19.9105, 99.8406],
                'Hanoi': [21.0278, 105.8342],
                'Ho Chi Minh City': [10.8231, 106.6297],
                'Hoi An': [15.8801, 108.3380],
                'Da Nang': [16.0544, 108.2022],
                'Sapa': [22.3364, 103.8438],
                'Phu Quoc': [10.2899, 103.9840],
                'Thimphu': [27.4728, 89.6393],
                'Paro': [27.4305, 89.4167],
                'Punakha': [27.5833, 89.8667],
                'Phuentsholing': [26.8516, 89.3886],
                'Hong Kong': [22.3193, 114.1694],
                'Lantau Island': [22.2667, 113.9333],
                'Baghdad': [33.3152, 44.3661],
                'Erbil': [36.1901, 44.0091],
                'Macau': [22.1987, 113.5439],
                'Cotai Strip': [22.1333, 113.5500],

                // AFRICA CITIES
                'Cairo': [30.0444, 31.2357],
                'Aswan': [24.0889, 32.8998],
                'Alexandria': [31.2001, 29.9187],
                'Giza': [30.0131, 31.2089],
                'Addis Ababa': [9.1450, 38.7644],
                'Accra': [5.6037, -0.1870],
                'Nairobi': [-1.2921, 36.8219],
                'Masai Mara': [-1.4061, 35.0175],
                'Marrakech': [31.6295, -7.9811],
                'Fes': [34.0181, -5.0078],
                'Chefchaouen': [35.1688, -5.2636],
                'Rabat': [34.0209, -6.8416],
                'Casablanca': [33.5731, -7.5898],
                'Tangier': [35.7595, -5.8340],
                'Lagos': [6.5244, 3.3792],
                'Abuja': [9.0765, 7.3986],
                'Dakar': [14.7167, -17.4677],
                'Saint-Louis': [16.0179, -16.4896],
                'Cape Town': [-33.9249, 18.4241],
                'Johannesburg': [-26.2041, 28.0473],
                'Kruger National Park': [-24.0167, 31.4833],
                'Serengeti': [-2.3333, 34.8333],
                'Zanzibar': [-6.1659, 39.2026],
                'Kilimanjaro': [-3.0674, 37.3556],
                'Tunis': [36.8065, 10.1815],
                'Tozeur': [33.9197, 8.1339],
                'Bwindi Impenetrable Forest': [-1.0476, 29.6951],
                'Kampala': [0.3476, 32.5825],
                'Victoria Falls': [-17.9244, 25.8567],
                'Hwange National Park': [-18.3667, 26.5000],
                'Mah√© Island': [-4.6796, 55.4920],
                'Praslin Island': [-4.3263, 55.7369],
                'La Digue': [-4.3608, 55.8300],

                // MIDDLE EAST CITIES
                'Isfahan': [32.6546, 51.6680],
                'Shiraz': [29.5918, 52.5837],
                'Muscat': [23.5880, 58.3829],
                'Wahiba Sands': [21.9167, 58.7500],
                'Doha': [25.2854, 51.5310],
                'Riyadh': [24.7136, 46.6753],
                'AlUla': [26.6174, 37.9112],
                'Makkah (Mecca)': [21.3891, 39.8579],
                'Mecca': [21.3891, 39.8579],
                'Medina': [24.5247, 39.5692],
                'Jeddah': [21.4858, 39.1925],
                'Abha': [18.2164, 42.5053],
                'Dammam & Khobar': [26.3927, 49.9777],
                'Taif': [21.4373, 40.5127],
                'Jerusalem': [31.7683, 35.2137],
                'Tel Aviv': [32.0853, 34.7818],
                'Petra': [30.3285, 35.4444],
                'Amman': [31.9454, 35.9284],
                'Dead Sea': [31.5000, 35.5000],
                'Beirut': [33.8938, 35.5018],
                'Byblos': [34.1236, 35.6481],
                'Istanbul': [41.0082, 28.9784],
                'Cappadocia': [38.6431, 34.8289],
                'Ephesus': [37.9390, 27.3417],
                'Antalya': [36.8969, 30.7133],
                'Ankara': [39.9334, 32.8597],
                'Izmir': [38.4237, 27.1428],
                'Ku≈üadasƒ±': [37.8579, 27.2610],
                'Bursa': [40.1885, 29.0610],
                'Kuwait City': [29.3759, 47.9774],
                'Damascus': [33.5138, 36.2765],
                'Dubai': [25.2048, 55.2708],
                'Abu Dhabi': [24.4539, 54.3773],
                'Sharjah': [25.3463, 55.4209],
                'Ras Al Khaimah': [25.7895, 55.9432],
                'Al Ain': [24.1302, 55.8023]
            };
            
            return coords[cityName] || null;
        }

        // ============================================
        // TRIP PLANNER FUNCTIONALITY
        // ============================================
        function isInTripPlanner() {
            const saved = JSON.parse(localStorage.getItem('tripPlanner') || '[]');
            const tripId = `city_${regionId}_${countryId}_${cityId}`;
            return saved.some(d => d.tripId === tripId);
        }

        function updateTripPlannerButton() {
            const btn = document.getElementById('tripPlannerBtn');
            const icon = document.getElementById('tripBtnIcon');
            const text = document.getElementById('tripBtnText');
            
            if (isInTripPlanner()) {
                btn.classList.add('saved');
                icon.textContent = '‚úì';
                text.textContent = 'Added to Trip Planner';
            } else {
                btn.classList.remove('saved');
                icon.textContent = 'üìå';
                text.textContent = 'Add to Trip Planner';
            }
        }

        function toggleTripPlanner() {
            let saved = JSON.parse(localStorage.getItem('tripPlanner') || '[]');
            const tripId = `city_${regionId}_${countryId}_${cityId}`;
            
            if (isInTripPlanner()) {
                saved = saved.filter(d => d.tripId !== tripId);
                localStorage.setItem('tripPlanner', JSON.stringify(saved));
                updateTripPlannerButton();
            } else {
                const tripData = {
                    tripId: tripId,
                    id: currentCity.id,
                    name: currentCity.name,
                    country: currentCity.country,
                    region: currentCity.region,
                    image: currentCity.image,
                    bestTime: currentCity.bestTime,
                    avgBudget: typeof currentCity.avgBudget === 'object' ? currentCity.avgBudget.mid : currentCity.avgBudget,
                    attractions: currentCity.attractions,
                    tips: currentCity.tips,
                    type: 'city',
                    addedAt: new Date().toISOString()
                };
                saved.push(tripData);
                localStorage.setItem('tripPlanner', JSON.stringify(saved));
                updateTripPlannerButton();
                showTripPlannerToast();
            }
        }

        function showTripPlannerToast() {
            const toast = document.createElement('div');
            toast.className = 'trip-toast';
            toast.innerHTML = `
                <span>‚úì Added to Trip Planner</span>
                <a href="trip-planner.html">View Trip ‚Üí</a>
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function askNova() {
            window.location.href = `nova.html?ask=${encodeURIComponent(`Tell me more about ${currentCity.name}, ${currentCity.country}`)}`;
        }

        function showError(message) {
            document.getElementById('cityTitle').textContent = message;
            document.getElementById('cityDescription').textContent = 'Please go back and select a valid city.';
            document.getElementById('attractionsList').innerHTML = '';
            document.getElementById('tipsList').innerHTML = '';
        }

        function setupNavToggle() {
            const navToggle = document.getElementById('navToggle');
            const navLinks = document.querySelector('.nav-links');
            
            if (navToggle) {
                navToggle.addEventListener('click', function() {
                    navLinks.classList.toggle('active');
                    navToggle.textContent = navLinks.classList.contains('active') ? '‚úï' : '‚ò∞';
                });
            }
        }
    </script>
</body>
</html>
